

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Base module &mdash; NFB Software User Guide 6.16.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8885e90a"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NDP submodule" href="ndp.html" />
    <link rel="prev" title="Modules" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            NFB Software User Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Common info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/nfb-tools.html">NFB tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/ndp-tools.html">NDP tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">libnfb reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libnfb-example.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libnfb-api-base.html">Base API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libnfb-api-ndp.html">NDP API reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python/quick.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/reference.html">Module Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Linux driver</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">Modules</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Base module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#component-locking">Component locking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ioctl">IOCTL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mi-submodule">MI submodule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#device-tree">Device Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memory-map">Memory Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">IOCTL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#boot-submodule">Boot submodule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">IOCTL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ndp.html">NDP submodule</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="userspace.html">Userspace access</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NFB Software User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">Modules</a></li>
      <li class="breadcrumb-item active">Base module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/driver/main.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="base-module">
<h1>Base module<a class="headerlink" href="#base-module" title="Link to this heading"></a></h1>
<p>This is a core driver for submodules.
It holds table of PCI compatible devices, for which it creates character node in /dev/nfb* .</p>
<section id="component-locking">
<h2>Component locking<a class="headerlink" href="#component-locking" title="Link to this heading"></a></h2>
<p>When the userspace application or attached module needs to get exclusive access to an component (based on FDT node), it can use the lock functions.
This ensures, that no other application on module can acquire lock to the same component.</p>
</section>
<section id="ioctl">
<h2>IOCTL<a class="headerlink" href="#ioctl" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>NFB_LOCK_IOC_TRY_LOCK - Try to lock a component feature in FDT for exclusive access</p></li>
<li><p>NFB_LOCK_IOC_UNLOCK - Unlock component in FDT</p></li>
</ul>
</section>
</section>
<section id="mi-submodule">
<h1>MI submodule<a class="headerlink" href="#mi-submodule" title="Link to this heading"></a></h1>
<p>Allows userspace application to map components from <code class="docutils literal notranslate"><span class="pre">/firmware</span></code> node to its virtual space.</p>
<section id="device-tree">
<h2>Device Tree<a class="headerlink" href="#device-tree" title="Link to this heading"></a></h2>
<p>Occupied node: <code class="docutils literal notranslate"><span class="pre">/driver/mi</span></code></p>
<p>subnode “PCIx,BARx” for each PCIe endpoint and its associated BAR configured as memory contains:</p>
<ul class="simple">
<li><p>property <code class="docutils literal notranslate"><span class="pre">mmap_base</span></code>: (uint64_t)</p></li>
<li><p>property <code class="docutils literal notranslate"><span class="pre">mmap_size</span></code>: (uint64_t)</p></li>
</ul>
</section>
<section id="memory-map">
<h2>Memory Map<a class="headerlink" href="#memory-map" title="Link to this heading"></a></h2>
<blockquote>
<div><p>Region bounded by base and size DT properties.</p>
</div></blockquote>
</section>
<section id="id1">
<h2>IOCTL<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<blockquote>
<div><p>None</p>
</div></blockquote>
</section>
</section>
<section id="boot-submodule">
<h1>Boot submodule<a class="headerlink" href="#boot-submodule" title="Link to this heading"></a></h1>
<p>This module allows to the user completely reconfigure programable device.</p>
<section id="id2">
<h2>IOCTL<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>NFB_BOOT_IOC_RELOAD</dt><dd><p>Reconfigure device. This command requires the caller to be the last opener of the <code class="docutils literal notranslate"><span class="pre">nfb%d</span></code> character device node.
After caller closes the node, module removes NFB device from system and issues the reconfigure command.</p>
</dd>
</dl>
</li>
<li><p>NFB_BOOT_IOC_ERRORS_DISABLE</p></li>
<li><p>NFB_BOOT_IOC_MTD_INFO</p></li>
<li><p>NFB_BOOT_IOC_MTD_READ</p></li>
<li><p>NFB_BOOT_IOC_MTD_WRITE</p></li>
<li><p>NFB_BOOT_IOC_MTD_ERASE</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-left" title="Modules" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ndp.html" class="btn btn-neutral float-right" title="NDP submodule" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>