

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>libnfb register access &mdash; NFB Software User Guide 6.16.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8885e90a"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="libnfb packet transmission" href="libnfb-quick-start-ndp.html" />
    <link rel="prev" title="Quick start" href="quick-start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NFB Software User Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tools/quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/index.html">Common info</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/nfb-tools.html">NFB tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/ndp-tools.html">NDP tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">libnfb reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="quick-start.html">Quick start</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">libnfb register access</a></li>
<li class="toctree-l2"><a class="reference internal" href="libnfb-quick-start-ndp.html">libnfb packet transmission</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="libnfb-example.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="libnfb-api-base.html">Base API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="libnfb-api-ndp.html">NDP API reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python module</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="python/quick.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="python/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="python/reference.html">Module Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Linux driver</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="driver/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="driver/userspace.html">Userspace access</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NFB Software User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="quick-start.html">Quick start</a></li>
      <li class="breadcrumb-item active">libnfb register access</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/libnfb-quick-start-registers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="libnfb-register-access">
<h1>libnfb register access<a class="headerlink" href="#libnfb-register-access" title="Link to this heading"></a></h1>
<p>libnfb exposes a simple API to the C language.
Let see how we can access to the firmware registers throught this API.</p>
<p>First thing in the code is to include header file.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nfb/nfb.h&gt;</span>
</pre></div>
</div>
<p>We need a handle to the NFB device.
Simply get the first device in system.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="nc">nfb_device</span><span class="w"> </span><span class="o">*</span><span class="n">dev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfb_open</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>As next step, obtain a handle to a component in the firmware.
But before that, the library needs to know the particular node in Device Tree, where the component we require is described.
Let find first node of the component whose <cite>‘compatible’</cite> property value is the NDK RX MAC compatibility string.
Don’t worry, with the <code class="xref c c-func docutils literal notranslate"><span class="pre">nfb_comp_find()</span></code> is really easy:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfb_comp_find</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;netcope,rxmac&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">nfb_comp</span><span class="w"> </span><span class="o">*</span><span class="n">comp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfb_comp_open</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">);</span>
</pre></div>
</div>
<p>Now we have a handle to access component’s internal registers.
One would like to know, if the RX MAC is enabled for the packet reception.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">RXMAC_REG_ENABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x20</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nfb_comp_read32</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span><span class="w"> </span><span class="n">RXMAC_REG_ENABLE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x01</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">enabled</span><span class="p">)</span>
<span class="w">    </span><span class="n">nfb_comp_write32</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span><span class="w"> </span><span class="n">RXMAC_REG_ENABLE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x01</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, the complete code needs to be compiled and linked with the <cite>-lnfb</cite> switch.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example is not quite the right way, how to control the RX MAC.
If we can’t use the <cite>nfb-eth -i0 -e1</cite> as we write in C, we should to use the <cite>rxmac</cite> <cite>libnetcope</cite> API.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quick-start.html" class="btn btn-neutral float-left" title="Quick start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="libnfb-quick-start-ndp.html" class="btn btn-neutral float-right" title="libnfb packet transmission" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, CESNET z.s.p.o..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>